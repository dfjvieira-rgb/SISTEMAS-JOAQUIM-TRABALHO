<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MENTORIA - INTELIG√äNCIA N√ÉO CONFUNDA</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        :root { --primary: #0f172a; --gold: #fbbf24; --purple: #a855f7; }
        body { font-family: 'Inter', sans-serif; background: #f1f5f9; margin: 0; padding: 15px; }
        .card { background: white; border-radius: 12px; padding: 20px; box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1); margin-bottom: 20px; border-left: 5px solid var(--gold); }
        h2 { color: var(--primary); font-size: 1.2rem; display: flex; align-items: center; gap: 10px; margin-bottom: 15px; }
        
        /* √ÅREA N√ÉO CONFUNDA */
        .alerta-box { background: #fff7ed; border: 1px solid #fed7aa; padding: 15px; border-radius: 8px; color: #9a3412; font-weight: bold; }
        
        /* HIST√ìRICO DE PDFS */
        .historico-pdf { background: #f8fafc; border: 1px solid #e2e8f0; border-radius: 8px; min-height: 100px; padding: 10px; }
        .pdf-item { display: flex; justify-content: space-between; align-items: center; padding: 8px; border-bottom: 1px solid #ddd; font-size: 0.9rem; }
        
        /* BOT√ÉO DISQUETE */
        .btn-save-pdf { background: var(--primary); color: var(--gold); border: none; padding: 12px; border-radius: 50%; width: 50px; height: 50px; cursor: pointer; position: fixed; bottom: 20px; right: 20px; box-shadow: 0 4px 10px rgba(0,0,0,0.3); transition: 0.3s; }
        .btn-save-pdf:hover { transform: scale(1.1); }
    </style>
</head>
<body>

    <div class="card">
        <h2><i class="fas fa-brain"></i> INTELIG√äNCIA N√ÉO CONFUNDA</h2>
        <div class="alerta-box" id="nao-confunda-content">
            Selecione uma pe√ßa no Radar para carregar as teses e alertas espec√≠ficos.
        </div>
    </div>

    <div class="card">
        <h2><i class="fas fa-history"></i> HIST√ìRICO DE ESTUDO (PDF)</h2>
        <div class="historico-pdf" id="lista-pdfs">
            </div>
    </div>

    <button class="btn-save-pdf" onclick="salvarApenasPDF()" title="Salvar PDF no Hist√≥rico">
        <i class="fas fa-save"></i>
    </button>

<script type="module">
    // Importa√ß√£o blindada - se falhar, o sistema de PDF continua via LocalStorage
    import { db } from './firebase-config.js';
    import { ref, set, push, onValue } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-database.js";

    // Fun√ß√£o de limpeza e organiza√ß√£o de conceito
    window.salvarApenasPDF = () => {
        const exameAtivo = localStorage.getItem('activeEx') || "44";
        const pdfNome = `ro${exameAtivo}.pdf`; // Define o padr√£o do PDF
        
        const novoRegistro = {
            arquivo: pdfNome,
            data: new Date().toLocaleString(),
            tipo: "PDF_ONLY"
        };

        // Salva no LocalStorage para garantir visualiza√ß√£o imediata
        let historico = JSON.parse(localStorage.getItem('historico_mentoria') || "[]");
        historico.push(novoRegistro);
        localStorage.setItem('historico_mentoria', JSON.stringify(historico));

        // Tenta salvar no Firebase se a conex√£o estiver ativa
        try {
            push(ref(db, 'mentoria_historico/'), novoRegistro);
        } catch(e) { console.log("Salvamento em nuvem pendente de config."); }

        renderizarHistorico();
        alert("üíæ PDF SALVO NO HIST√ìRICO DA MENTORIA!");
    };

    function renderizarHistorico() {
        const lista = document.getElementById('lista-pdfs');
        const historico = JSON.parse(localStorage.getItem('historico_mentoria') || "[]");
        
        // Limpa o que n√£o √© PDF antes de arranjar o conceito
        lista.innerHTML = historico
            .filter(item => item.arquivo.endsWith('.pdf'))
            .map(item => `
                <div class="pdf-item">
                    <span><i class="fas fa-file-pdf" style="color:red"></i> ${item.arquivo}</span>
                    <small>${item.data}</small>
                </div>
            `).join('');
    }

    // Carregar dados iniciais
    window.onload = renderizarHistorico;
</script>
</body>
</html>
